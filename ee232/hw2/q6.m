%% topology1: 0 1 1 1 1 1 
clear; clc;

B = [
    -20 0 10 10;
    0 -20 10 10;
    10 10 -30 10;
    10 10 10 -30;
];

B_ = [
    -20 10 10;
    10 -30 10;
    10 10 -30;
    ];

cvx_begin
    variables p1 p2 p3 th2 th3 th4
    minimize 561+792*p1+15.62*p1^2 + 310+785*p2+19.40*p2^2 + 78+797*p3+48.2*p3^2
    subject to
        p1>=1; p1<=4; 
        p2>=1; p2<=4;
        p3>=1; p2<=4;
        p1+p2+p3==5;
        [th2; th3; th4] == inv(B_) * [p2-1; p3; -4];
        
        abs(B(1,3)*(-th3))<=1.5; % p13, p31
        abs(B(1,4)*(-th4))<=1.5; % p14, p41
        abs(B(2,3)*(th2-th3))<=1.5; % p23, p32
        abs(B(2,4)*(th2-th4))<=1.5; % p24, p42
        abs(B(3,4)*(th3-th4))<=1.5; % p34, p43
cvx_end
    
%% topology2: 1 0 1 1 1 1
clear; clc;
B = [
    -20 10 10 0;
    10 -30 10 10;
    10 10 -30 10;
    0 10 10 -20;
    ];

B_ = [
    -30 10 10;
    10 -30 10;
    10 10 -20;];

cvx_begin
    variables p1 p2 p3 th2 th3 th4
    minimize 561+792*p1+15.62*p1^2 + 310+785*p2+19.40*p2^2 + 78+797*p3+48.2*p3^2
    subject to
        p1>=1; p1<=4; 
        p2>=1; p2<=4;
        p3>=1; p2<=4;
        p1+p2+p3==5;
        [th2; th3; th4] == inv(B_) * [p2-1; p3; -4];
        
        abs(B(1,2)*(-th2))<=1.5; % p12, p21
        abs(B(1,3)*(-th3))<=1.5; % p13, p31
        abs(B(2,3)*(th2-th3))<=1.5; % p23, p32
        abs(B(2,4)*(th2-th4))<=1.5; % p24, p42
        abs(B(3,4)*(th3-th4))<=1.5; % p34, p43
cvx_end

%% topology3: 1 1 0 1 1 1
clear; clc;
B = [
    -20 10 0 10;
    10 -30 10 10;
    0 10 -20 10;
    10 10 10 -30;
    ];

B_ = [
    -30 10 10;
    10 -20 10;
    10 10 -30;];

cvx_begin
    variables p1 p2 p3 th2 th3 th4
    minimize 561+792*p1+15.62*p1^2 + 310+785*p2+19.40*p2^2 + 78+797*p3+48.2*p3^2
    subject to
        p1>=1; p1<=4; 
        p2>=1; p2<=4;
        p3>=1; p2<=4;
        p1+p2+p3==5;
        [th2; th3; th4] == inv(B_) * [p2-1; p3; -4];
        
        abs(B(1,2)*(-th2))<=1.5; % p12, p21
        abs(B(1,4)*(-th4))<=1.5; % p14, p41
        abs(B(2,3)*(th2-th3))<=1.5; % p23, p32
        abs(B(2,4)*(th2-th4))<=1.5; % p24, p42
        abs(B(3,4)*(th3-th4))<=1.5; % p34, p43
cvx_end

%% topology4: 1 1 1 0 1 1 
clear; clc;
B = [
    -30 10 10 10;
    10 -30 10 10;
    10 10 -20 0;
    10 10 0 -20;
    ];

B_ = [
    -30 10 10;
    10 -20 0;
    10 0 -20;];

cvx_begin
    variables p1 p2 p3 th2 th3 th4
    minimize 561+792*p1+15.62*p1^2 + 310+785*p2+19.40*p2^2 + 78+797*p3+48.2*p3^2
    subject to
        p1>=1; p1<=4; 
        p2>=1; p2<=4;
        p3>=1; p2<=4;
        p1+p2+p3==5;
        [th2; th3; th4] == inv(B_) * [p2-1; p3; -4];
        
        abs(B(1,2)*(-th2))<=1.5; % p12, p21
        abs(B(1,3)*(-th3))<=1.5; % p13, p31
        abs(B(1,4)*(-th4))<=1.5; % p14, p41
        abs(B(2,3)*(th2-th3))<=1.5; % p23, p32
        abs(B(2,4)*(th2-th4))<=1.5; % p24, p42
cvx_end

%% topology5: 1 1 1 1 0 1
clear; clc;
B = [
    -30 10 10 10;
    10 -20 0 10;
    10 0 -20 10;
    10 10 10 -30;
    ];

B_ = [
    -20 0 10;
    0 -20 10;
    10 10 -30;];

cvx_begin
    variables p1 p2 p3 th2 th3 th4
    minimize 561+792*p1+15.62*p1^2 + 310+785*p2+19.40*p2^2 + 78+797*p3+48.2*p3^2
    subject to
        p1>=1; p1<=4; 
        p2>=1; p2<=4;
        p3>=1; p2<=4;
        p1+p2+p3==5;
        [th2; th3; th4] == inv(B_) * [p2-1; p3; -4];
        
        abs(B(1,2)*(-th2))<=1.5; % p12, p21
        abs(B(1,3)*(-th3))<=1.5; % p13, p31
        abs(B(1,4)*(-th4))<=1.5; % p14, p41
        abs(B(2,4)*(th2-th4))<=1.5; % p24, p42
        abs(B(3,4)*(th3-th4))<=1.5; % p34, p43
cvx_end

%% topology6: 1 1 1 1 1 0 
clear; clc;
B = [
    -30 10 10 10;
    10 -20 10 0;
    10 10 -30 10;
    10 0 10 -20;
    ];

B_ = [
    -20 10 0;
    10 -30 10;
    0 10 -20;];

cvx_begin
    variables p1 p2 p3 th2 th3 th4
    minimize 561+792*p1+15.62*p1^2 + 310+785*p2+19.40*p2^2 + 78+797*p3+48.2*p3^2
    subject to
        p1>=1; p1<=4; 
        p2>=1; p2<=4;
        p3>=1; p2<=4;
        p1+p2+p3==5;
        [th2; th3; th4] == inv(B_) * [p2-1; p3; -4];
        
        abs(B(1,2)*(-th2))<=1.5; % p12, p21
        abs(B(1,3)*(-th3))<=1.5; % p13, p31
        abs(B(1,4)*(-th4))<=1.5; % p14, p41
        abs(B(2,3)*(th2-th3))<=1.5; % p23, p32
        abs(B(3,4)*(th3-th4))<=1.5; % p34, p43
cvx_end