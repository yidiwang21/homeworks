clear; clc;
I = [-0.06454
-0.06454
-0.06454
-0.06454
-0.06454
-0.06454
0.93546
1.43546
1.43546
1.43546
1.43546
1.43546
1.43546
1.43546
1.43546
1.43546
1.43546
1.43546
1.93546
2.93546
2.93546
2.93546
2.93546
3.43546
3.43546
4.43546
4.93546
3.43546
2.93546
2.93546
2.93546
2.93546
2.93546
3.43546
5.43546
7.93546
9.43546
11.43546
15.93546
19.93546
22.43546
25.93546
31.43546
37.93546
42.43546
45.43546
52.93546
59.93546
63.43546
67.43546
74.93546
82.43546
86.43546
88.93546
96.43546
101.93546
105.93546
107.93546
113.43546
116.93546
117.93546
119.93546
122.43546
123.43546
124.43546
123.93546
121.43546
119.93546
119.43546
115.43546
112.43546
107.43546
106.93546
102.43546
95.93546
88.93546
87.93546
78.93546
68.43546
57.43546
56.43546
43.93546
31.93546
22.93546
22.43546
14.93546
11.43546
9.43546
8.43546
9.43546
10.43546
12.93546
13.43546
16.43546
19.93546
22.93546
25.93546
31.43546
37.43546
41.93546
44.93546
52.43546
59.93546
64.43546
69.43546
77.93546
85.49102
90.43546
94.43546
102.93546
110.43546
114.93546
118.43546
124.93546
131.43546
134.43546
137.43546
142.43546
146.43546
148.93546
150.43546
151.93546
152.93546
153.93546
152.93546
151.93546
151.43546
151.43546
149.43546
146.43546
141.43546
138.43546
134.93546
126.93546
118.93546
114.93546
109.43546
98.93546
86.93546
80.93546
73.43546
58.43546
41.43546
32.93546
26.43546
13.43546
6.43546
2.93546
1.93546
1.43546
0.93546
-0.06454
-0.06454
-0.06454
-0.06454
-0.06454
-0.06454
-0.56454
-1.06454
-1.06454
-1.06454
-1.06454
-1.06454
-1.06454
-1.06454
-2.06454
-2.56454
-2.56454
-2.56454
-2.56454
-3.06454
-3.56454
-4.06454
-4.06454
-4.06454
-4.06454
-4.06454
-4.06454
-4.06454
-4.06454
-4.06454
-4.06454
-4.06454
-4.06454
-4.06454
-4.06454
-4.56454
-4.56454
-5.56454
-5.56454
-4.56454
-4.56454
-5.56454
-6.56454
-6.56454
-6.56454
-6.56454
-6.56454
-6.56454
-6.56454
-6.56454
-6.56454
-6.56454
-6.56454
-6.56454
-6.56454
-6.56454
-6.56454
-6.56454
-8.56454
-9.56454
-11.56454
-14.56454
-18.56454
-20.06454
-23.06454
-27.56454
-32.56454
-35.56454
-38.56454
-45.56454
-52.06454
-56.06454
-60.56454
-67.06454
-74.06454
-78.06454
-81.06454
-87.56454
-93.06454
-96.56454
-99.06454
-103.06454
-107.06454
-109.06454
-110.56454
-112.56454
-113.56454
-113.56454
-113.56454
-113.56454
-113.56454
-112.56454
-110.56454
-108.06454
-104.06454
-102.06454
-99.06454
-91.06454
-84.06454
-79.56454
-74.06454
-63.56454
-52.06454
-51.56454
-40.56454
-29.06454
-21.56454
-20.56454
-15.06454
-13.06454
-12.56454
-11.56454
-11.56454
-12.56454
-13.56454
-13.56454
-14.06454
-15.56454
-18.56454
-19.56454
-22.56454
-26.56454
-31.06454
-31.56454
-37.06454
-44.06454
-50.06454
-51.06454
-58.56454
-67.06454
-73.56454
-73.56454
-81.06454
-88.06454
-94.56454
-95.56454
-102.06454
-107.56454
-113.06454
-114.06454
-117.56454
-121.06454
-123.06454
-124.06454
-126.56454
-129.06454
-130.56454
-131.56454
-132.06454
-131.56454
-129.56454
-128.56454
-125.56454
-121.06454
-118.56454
-115.56454
-109.56454
-102.56454
-99.56454
-94.06454
-83.56454
-73.56454
-67.56454
-60.06454
-47.56454
-34.06454
-26.56454
-21.06454
-13.06454
-8.06454
-6.56454
-6.06454
-5.56454
-4.06454
-4.06454
-4.06454
-4.06454
-4.06454
-4.06454
-4.06454
-4.06454
-4.06454
-4.06454
-4.06454
-3.06454
-2.56454
-2.56454
-2.56454
-2.56454
-2.06454
-1.56454
-1.06454
-1.06454
-1.06454
-1.06454
-1.06454
-0.56454
-0.06454
-0.06454];

time = 0:16.67/349:16.67;
figure;
subplot(2,1,1);
plot(time, I);
xlabel('Time(msec)');
ylabel('Current');
title('Signal Amplitude');

x = abs(fft(I));
y = max(x);
z = x/y;    % to represent harmonic signals in percentage of fundamental

fs = 350*60;
f = 60; % fundamental freq
num_sample = 350;
f = 0:fs/num_sample:fs-fs/num_sample;
f = f/60;

subplot(2,1,2);
bar(f,z); xlim([0 25]), grid
set(gca,'XTick',(0:1:25));

%%
THD = sqrt( 0.061^2 + 0.121^2 + 0.036^2 + 0.56^2 + 0.034^2 + 0.298^2 + 0.031^2 + 0.06^2 + 0.046^2 + 0.016^2 + 0.028^2 );

I_peak = max(I);

sum = 0;
for k = 1:350
    sum = sum + I(k)^2;
end

I_rms = sqrt(sum/350);

CF = I_peak/I_rms;

%%

fs = 350/16.67;
dt = 1/fs;
stop_time = 16.67;
start_time = 0;
t = (0:dt:stop_time-dt)';
N = size(t,1);

X = fftshift(fft(I));
df = fs/N;
f = -fs/2:df:fs/2-df;


plot(f,abs(X)/N);
xlabel('Frequency(Hz)');
ylabel('Magnitude');
title('Harmonic Spectrum');
